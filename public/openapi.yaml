openapi: 3.0.3
info:
  title: iShelf Docs
  description: |
    iShelf is a comprehensive shelf management and product inventory system for retail operations.

    Key Features
    - **Shelf Management** - Manage physical shelves across retail branches
    - **Product & Stock Management** - Track inventory and stock levels
    - **Price Tag Management** - Create and manage price tags (senniks)
    - **Auto-Ordering System** - Automatically fill shelves with products
    - **Application Workflow** - Handle shelf application requests with multi-step approval
    - **Telegram Integration** - Real-time notifications via Telegram bot
  version: 1.0.0

servers:
  - url: http://localhost:8000/api
    description: Local development server

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User management operations
  - name: Shelves
    description: Shelf CRUD and management
  - name: Products
    description: Product listing and management
  - name: Stock
    description: Stock synchronization
  - name: Price Tags
    description: Price tag (sennik) management
  - name: Auto-ordering
    description: Temporary shelf arrangements and auto-ordering
  - name: Branches and regions
    description: Branch and regions list
  - name: Categories
    description: Product category management
  - name: Applications
    description: Shelf application workflow
  - name: File upload
    description: File upload operations

security:
  - sanctum: [ ]

paths:
  # ============================================
  # AUTHENTICATION ENDPOINTS
  # ============================================
  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login
      security: [ ]
      description: Authenticate user with phone and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
                - password
              properties:
                phone:
                  type: string
                  example: '998991234567'
                password:
                  type: string
                  example: 'password123'
      responses:
        200:
          description: success
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: 'abc123def456...'
                  with_sms:
                    type: boolean
                    example: true
                  expire_at:
                    type: string
                    example: "2025-12-12 00:00:00"
                    description: 120 seconds after now

  /auth/login/check_sms:
    post:
      tags:
        - Authentication
      summary: Verify SMS code
      description: Check SMS verification code
      security: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otp
                - token
              properties:
                otp:
                  type: string
                  example: '0000'
                token:
                  type: string
                  example: 'abc123def456...'
      responses:
        '200':
          description: success
          content:
            application/json:
              schema:
                type: object
                required:
                  - otp
                  - token
                properties:
                  token_type:
                    type: string
                    example: 'Bearer'
                  access_token:
                    type: string
                    example: '1|abc123def456...'
                  expires_at:
                    type: string
                    example: '2025-12-12 23:59:59'
                    description: 'Until end of the day'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get authenticated user
      description: Retrieve current authenticated user
      responses:
        '200':
          description: User information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    get:
      tags:
        - Authentication
      summary: Logout user
      description: Remove current authentication token
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  # ============================================
  # USERS ENDPOINTS
  # ============================================
  /user/list:
    get:
      tags:
        - Users
      summary: List
      description: Get users list
      parameters:
        - in: 'path'
          name: 'search'
          description: "Search"
          required: false
          schema:
            type: string
      responses:
        '200':
          description: "success"
          content:
            application/json:
              schema:
                type: object
                example:
                  - $ref: '#/components/schemas/User'


# ============================================
# COMPONENTS
# ============================================
components:
  securitySchemes:
    sanctum:
      type: http
      scheme: bearer
      bearerFormat: 'Sanctum Token'
      description: Laravel Sanctum authentication token

    projects_token:
      type: apiKey
      in: header
      name: X-Projects-Token
      description: Service-to-service authentication token

  parameters:
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number for pagination

    PerPage:
      name: per_page
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 15
      description: Items per page

  responses:
    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: 'Unauthenticated.'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: 'Resource not found'

    ValidationError:
      description: Validation error - Invalid request parameters
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: 'The given data was invalid.'
              errors:
                type: object
                additionalProperties:
                  type: array
                  items:
                    type: string

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: 'John'
        surname:
          type: string
          example: 'Doe'
        patronymic:
          type: string
          example: 'Smith'
        phone:
          type: string
          example: '998901234567'
        pinfl:
          type: string
          example: '12345678901234'
        is_admin:
          type: integer
          example: 1
        role:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
        branches:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string
        status:
          type: integer
          enum: [ 0, 1 ]
          description: 0=inactive, 1=active
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Product:
      type: object
      properties:
        id:
          type: integer
        sku:
          type: integer
          description: Unique product identifier
        name:
          type: string
        category_sku:
          type: integer
        brand_sku:
          type: integer
        price:
          type: number
          format: float
        status:
          type: integer
          enum: [ 1, 2 ]
          description: 1=active, 2=sold
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Shelf:
      type: object
      properties:
        id:
          type: integer
        type:
          type: integer
          description: Shelf type (1-10)
        category_sku:
          type: integer
        branch_id:
          type: integer
        product_count:
          type: integer
        floor:
          type: integer
        size:
          type: integer
        is_paddon:
          type: integer
          enum: [ 0, 1 ]
        paddon_quantity:
          type: integer
        products:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PaginatedResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            current_page:
              type: integer
            data:
              type: array
              items:
                type: object
            first_page_url:
              type: string
            from:
              type: integer
            last_page:
              type: integer
            last_page_url:
              type: string
            next_page_url:
              type: string
            path:
              type: string
            per_page:
              type: integer
            prev_page_url:
              type: string
            to:
              type: integer
            total:
              type: integer
